<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>আকিজ হেলথ কেয়ার এন্ড হাইজিন লিমিটেড</title>
    <meta name="theme-color" content="#10b981">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
:root {
    --primary: #10b981;
    --secondary: #6b7280;
    --success: #059669;
    --danger: #dc2626;
    --warning: #d97706;
    --info: #0ea5e9;
    --light: #f3f4f6;
    --dark: #1f2937;
    --accent: #8b5cf6;
}

body {
    font-family: 'Hind Siliguri', sans-serif;
    background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
    min-height: 100vh;
    color: #fff;
    margin: 0;
    padding-bottom: 100px;
}

.header {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    padding: 15px;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    border-bottom: 1px solid rgba(255, 255, 255, 0.15);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
}

.header h1 {
    font-size: 1.4rem;
    font-weight: 800;
    margin: 0;
    background: linear-gradient(90deg, #10b981, #34d399);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.sales-info {
    background: linear-gradient(90deg, #10b981, #34d399);
    padding: 6px 14px;
    border-radius: 50px;
    font-size: 0.9rem;
    font-weight: 600;
    color: white;
    box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
}

.content {
    margin-top: 120px;
    padding: 15px;
}

.card-x {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(15px);
    border-radius: 20px;
    padding: 16px;
    margin-bottom: 16px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.product-card {
    background: rgba(255, 255, 255, 0.08);
    border-radius: 16px;
    padding: 14px;
    margin: 8px 0;
    transition: 0.3s all;
    border: 1px solid rgba(255, 255, 255, 0.05);
}

.product-card:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-4px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
}

.total {
    font-size: 2.4rem;
    font-weight: 800;
    background: linear-gradient(90deg, #10b981, #34d399);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.fab-btn {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
    font-size: 1.7rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: 0.3s;
    border: none;
}

.fab-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5);
}

.fab-container {
    position: fixed;
    bottom: 22px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 999;
    display: flex;
    gap: 18px;
}

#passwordScreen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
}

.pass-box {
    background: linear-gradient(135deg, #1e293b, #334155);
    color: #fff;
    padding: 40px 30px;
    border-radius: 20px;
    text-align: center;
    max-width: 320px;
    width: 90%;
    box-shadow: 0 15px 40px rgba(0, 0, 0, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.pass-box h3 {
    margin-bottom: 20px;
    color: #10b981;
}

.pass-box input {
    font-size: 1.4rem;
    text-align: center;
    letter-spacing: 8px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: white;
}

.pass-box input::placeholder {
    color: rgba(255, 255, 255, 0.5);
}

.pass-box button {
    margin-top: 20px;
    background: linear-gradient(90deg, #10b981, #34d399);
    border: none;
}

.stock-low {
    border-left: 4px solid #f59e0b;
    background: rgba(245, 158, 11, 0.1);
}

.stock-out {
    border-left: 4px solid #dc2626;
    background: rgba(220, 38, 38, 0.1);
    opacity: 0.8;
}

.loading {
    animation: pulse 1.5s infinite;
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.7; }
    100% { opacity: 1; }
}

.nav-tabs {
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.nav-tabs .nav-link {
    color: rgba(255, 255, 255, 0.7);
    border: none;
    background: rgba(255, 255, 255, 0.05);
    margin-right: 5px;
    border-radius: 10px 10px 0 0;
    transition: all 0.3s;
}

.nav-tabs .nav-link:hover {
    color: white;
    background: rgba(255, 255, 255, 0.1);
}

.nav-tabs .nav-link.active {
    background: linear-gradient(135deg, #10b981, #34d399);
    color: white;
    border: none;
    box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
}

.table-container {
    max-height: 400px;
    overflow-y: auto;
    border-radius: 10px;
    background: rgba(255, 255, 255, 0.05);
}

.customer-badge {
    background: linear-gradient(90deg, #10b981, #34d399);
    border-radius: 20px;
    padding: 5px 12px;
    margin: 2px;
    display: inline-block;
    font-size: 0.8rem;
    color: white;
}

.template-card {
    cursor: pointer;
    transition: all 0.3s;
    background: rgba(255, 255, 255, 0.08);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.template-card:hover {
    transform: scale(1.02);
    background: rgba(255, 255, 255, 0.15);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
}

.chart-container {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    padding: 15px;
    margin-bottom: 20px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

/* ফর্ম এলিমেন্ট স্টাইল */
.form-control, .form-select {
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: white;
    border-radius: 10px;
}

.form-control:focus, .form-select:focus {
    background: rgba(255, 255, 255, 0.15);
    border-color: #10b981;
    color: white;
    box-shadow: 0 0 0 0.2rem rgba(16, 185, 129, 0.25);
}

.form-control::placeholder {
    color: rgba(255, 255, 255, 0.5);
}

/* টেবিল স্টাইল */
.table {
    color: white;
    border-color: rgba(255, 255, 255, 0.1);
}

.table-dark {
    --bs-table-bg: transparent;
    --bs-table-striped-bg: rgba(255, 255, 255, 0.05);
    --bs-table-hover-bg: rgba(255, 255, 255, 0.1);
}

.table th {
    background: rgba(16, 185, 129, 0.2);
    border-color: rgba(255, 255, 255, 0.1);
    font-weight: 600;
}

.table td {
    border-color: rgba(255, 255, 255, 0.05);
    vertical-align: middle;
}

/* বাটন স্টাইল */
.btn {
    border-radius: 10px;
    font-weight: 600;
    transition: all 0.3s;
}

.btn-primary {
    background: linear-gradient(90deg, #10b981, #34d399);
    border: none;
}

.btn-primary:hover {
    background: linear-gradient(90deg, #0da271, #2bbd8b);
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
}

.btn-success {
    background: linear-gradient(90deg, #059669, #10b981);
    border: none;
}

.btn-danger {
    background: linear-gradient(90deg, #dc2626, #ef4444);
    border: none;
}

.btn-warning {
    background: linear-gradient(90deg, #d97706, #f59e0b);
    border: none;
    color: white;
}

.btn-info {
    background: linear-gradient(90deg, #0ea5e9, #38bdf8);
    border: none;
}

/* হোভার ইফেক্ট */
.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
}

/* স্ক্রলবার স্টাইল */
.table-container::-webkit-scrollbar {
    width: 8px;
}

.table-container::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
}

.table-container::-webkit-scrollbar-thumb {
    background: linear-gradient(90deg, #10b981, #34d399);
    border-radius: 10px;
}

.table-container::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(90deg, #0da271, #2bbd8b);
}

/* রেসপন্সিভ ডিজাইন */
@media (max-width: 768px) {
    .header h1 {
        font-size: 1.2rem;
    }
    
    .sales-info {
        font-size: 0.8rem;
    }
    
    .content {
        margin-top: 100px;
        padding: 10px;
    }
    
    .fab-container {
        bottom: 15px;
        gap: 12px;
    }
    
    .fab-btn {
        width: 45px;
        height: 45px;
        font-size: 1.5rem;
    }
    
    .total {
        font-size: 2rem;
    }
}

/* অ্যানিমেশন */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.card-x, .product-card {
    animation: fadeIn 0.5s ease-out;
}

/* গ্লো ইফেক্ট */
.glow-effect {
    box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
}

/* কাস্টম চেকবক্স */
.form-check-input:checked {
    background-color: #10b981;
    border-color: #10b981;
}

.form-check-input:focus {
    border-color: #10b981;
    box-shadow: 0 0 0 0.2rem rgba(16, 185, 129, 0.25);
}

/* ইনপুট গ্রুপ */
.input-group-text {
    background: rgba(16, 185, 129, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: white;
}

/* ব্যাজ স্টাইল */
.badge {
    font-weight: 600;
}

.badge.bg-primary {
    background: linear-gradient(90deg, #10b981, #34d399) !important;
}

/* ট্যাব কন্টেন্ট ট্রানজিশন */
.tab-pane {
    animation: fadeIn 0.3s ease-out;
}
</style>
</head>
<body>

<!-- পাসওয়ার্ড স্ক্রিন -->
<div id="passwordScreen">
    <div class="pass-box">
        <h3><i class="bi bi-shield-lock-fill"></i> পাসওয়ার্ড দিন</h3>
        <input type="password" id="passInput" class="form-control form-control-lg" placeholder="******" maxlength="8">
        <button class="btn btn-primary btn-lg w-100 mt-3" onclick="checkPass()">খুলুন</button>
        <small class="d-block mt-3 text-muted">আকিজ হেলথকেয়ার</small>
    </div>
</div>

<div class="header text-center">
    <h1>আকিজ হেলথকেয়ার এন্ড হাইজিন লিমিটেড</h1>
    <div class="sales-info">অসীম কর্মকার • ডুমুরিয়া • +880 1989-001122</div>
</div>

<div class="content container">
    <!-- ট্যাব নেভিগেশন -->
    <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab">অর্ডার</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="customers-tab" data-bs-toggle="tab" data-bs-target="#customers" type="button" role="tab">কাস্টমার</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="stock-tab" data-bs-toggle="tab" data-bs-target="#stock" type="button" role="tab">স্টক</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="templates-tab" data-bs-toggle="tab" data-bs-target="#templates" type="button" role="tab">টেমপ্লেট</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="reports-tab" data-bs-toggle="tab" data-bs-target="#reports" type="button" role="tab">রিপোর্ট</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button" role="tab">সেটিংস</button>
        </li>
    </ul>

    <!-- ট্যাব কন্টেন্ট -->
    <div class="tab-content" id="myTabContent">
        <!-- অর্ডার ট্যাব -->
        <div class="tab-pane fade show active" id="home" role="tabpanel">
            <div class="card-x">
                <div class="row g-3">
                    <div class="col-12 col-md-6">
                        <input type="text" id="shopName" class="form-control" placeholder="দোকানের নাম" required list="customerList">
                        <datalist id="customerList"></datalist>
                    </div>
                    <div class="col-12 col-md-6">
                        <input type="text" id="shopAddress" class="form-control" placeholder="ঠিকানা">
                    </div>
                    <div class="col-12 col-md-6">
                        <input type="text" id="mobile" class="form-control" placeholder="মোবাইল নম্বর">
                    </div>
                    <div class="col-12 col-md-6">
                        <input type="date" id="deliveryDate" class="form-control">
                    </div>
                </div>
            </div>

            <div class="card-x mb-3">
                <input type="text" id="search" class="form-control form-control-lg" placeholder="প্রোডাক্ট খুঁজুন..." autocomplete="off">
            </div>

            <div class="d-flex justify-content-between align-items-center mb-4 bg-dark bg-opacity-10 rounded-4 p-3">
                <h4 class="mb-0 text-white"><i class="bi bi-basket3-fill"></i> <span id="cartCount">0</span> আইটেম</h4>
                <h2 class="total">৳<span id="totalAmount">0</span></h2>
            </div>

            <div id="productList" class="mb-5"></div>
        </div>

        <!-- কাস্টমার ট্যাব -->
        <div class="tab-pane fade" id="customers" role="tabpanel">
            <div class="card-x">
                <h4 class="mb-3"><i class="bi bi-people-fill"></i> কাস্টমার ম্যানেজমেন্ট</h4>
                
                <div class="row g-3 mb-4">
                    <div class="col-md-4">
                        <input type="text" id="customerName" class="form-control" placeholder="কাস্টমার নাম">
                    </div>
                    <div class="col-md-4">
                        <input type="text" id="customerMobile" class="form-control" placeholder="মোবাইল নম্বর">
                    </div>
                    <div class="col-md-4">
                        <input type="text" id="customerArea" class="form-control" placeholder="এলাকা">
                    </div>
                    <div class="col-12">
                        <textarea id="customerAddress" class="form-control" placeholder="সম্পূর্ণ ঠিকানা" rows="2"></textarea>
                    </div>
                    <div class="col-12">
                        <button class="btn btn-success w-100" onclick="addCustomer()"><i class="bi bi-person-plus"></i> কাস্টমার যোগ করুন</button>
                    </div>
                </div>
                
                <div class="table-container">
                    <table class="table table-hover table-dark">
                        <thead>
                            <tr>
                                <th>নাম</th>
                                <th>মোবাইল</th>
                                <th>এলাকা</th>
                                <th>অ্যাকশন</th>
                            </tr>
                        </thead>
                        <tbody id="customerTable">
                            <!-- কাস্টমার ডাটা এখানে লোড হবে -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- স্টক ম্যানেজমেন্ট ট্যাব -->
        <div class="tab-pane fade" id="stock" role="tabpanel">
            <div class="card-x">
                <h4 class="mb-3"><i class="bi bi-box-seam"></i> স্টক ম্যানেজমেন্ট</h4>
                
                <div class="row g-3 mb-4">
                    <div class="col-md-6">
                        <select id="stockProduct" class="form-select">
                            <option value="">প্রোডাক্ট নির্বাচন করুন</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select id="stockAction" class="form-select">
                            <option value="add">স্টক যোগ করুন</option>
                            <option value="subtract">স্টক বিয়োগ করুন</option>
                            <option value="set">স্টক সেট করুন</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <input type="number" id="stockQty" class="form-control" placeholder="পরিমাণ" min="1">
                    </div>
                    <div class="col-12">
                        <textarea id="stockNote" class="form-control" placeholder="নোট (ঐচ্ছিক)" rows="2"></textarea>
                    </div>
                    <div class="col-12">
                        <button class="btn btn-primary w-100" onclick="updateStock()"><i class="bi bi-save"></i> স্টক আপডেট করুন</button>
                    </div>
                </div>
                
                <h5 class="mb-3"><i class="bi bi-clock-history"></i> স্টক হিস্ট্রি</h5>
                <div class="table-container mb-4">
                    <table class="table table-hover table-dark">
                        <thead>
                            <tr>
                                <th>তারিখ</th>
                                <th>প্রোডাক্ট</th>
                                <th>পরিবর্তন</th>
                                <th>পরিমাণ</th>
                                <th>নোট</th>
                            </tr>
                        </thead>
                        <tbody id="stockHistoryTable">
                            <!-- স্টক হিস্ট্রি এখানে লোড হবে -->
                        </tbody>
                    </table>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="card-x">
                            <h6 class="text-warning"><i class="bi bi-exclamation-triangle"></i> কম স্টক</h6>
                            <div id="lowStockList">
                                <!-- কম স্টক প্রোডাক্ট লোড হবে -->
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card-x">
                            <h6 class="text-danger"><i class="bi bi-x-circle"></i> স্টক ফুরিয়েছে</h6>
                            <div id="outOfStockList">
                                <!-- স্টক ফুরানো প্রোডাক্ট লোড হবে -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- টেমপ্লেট ট্যাব -->
        <div class="tab-pane fade" id="templates" role="tabpanel">
            <div class="card-x">
                <h4 class="mb-3"><i class="bi bi-bookmark-check"></i> অর্ডার টেমপ্লেট</h4>
                
                <div class="row" id="templateList">
                    <!-- টেমপ্লেট গুলো এখানে লোড হবে -->
                </div>
            </div>
        </div>

        <!-- রিপোর্ট ট্যাব -->
        <div class="tab-pane fade" id="reports" role="tabpanel">
            <div class="card-x">
                <h4 class="mb-3"><i class="bi bi-graph-up"></i> সেলস রিপোর্ট</h4>
                
                <div class="row mb-4">
                    <div class="col-md-6">
                        <input type="date" id="reportStartDate" class="form-control">
                    </div>
                    <div class="col-md-6">
                        <input type="date" id="reportEndDate" class="form-control">
                    </div>
                </div>
                
                <div class="chart-container">
                    <h5 class="text-center">সেলস সামারি</h5>
                    <canvas id="salesChart" width="300" height="150"></canvas>
                </div>
                
                <div class="table-container">
                    <table class="table table-hover table-dark">
                        <thead>
                            <tr>
                                <th>তারিখ</th>
                                <th>দোকান</th>
                                <th>আইটেম</th>
                                <th>মোট</th>
                            </tr>
                        </thead>
                        <tbody id="reportTable">
                            <!-- রিপোর্ট ডাটা এখানে লোড হবে -->
                        </tbody>
                    </table>
                </div>
                
                <button class="btn btn-primary w-100 mt-3" onclick="generateReport()"><i class="bi bi-file-earmark-pdf"></i> রিপোর্ট জেনারেট করুন</button>
            </div>
        </div>

        <!-- সেটিংস ট্যাব -->
        <div class="tab-pane fade" id="settings" role="tabpanel">
            <div class="card-x">
                <h4 class="mb-3"><i class="bi bi-gear-fill"></i> সিস্টেম সেটিংস</h4>
                
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">ইউজার নাম</label>
                        <input type="text" class="form-control" value="অসীম কর্মকার" readonly>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">এরিয়া</label>
                        <input type="text" class="form-control" value="ডুমুরিয়া" readonly>
                    </div>
                    
                    <div class="col-12">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="stockAlert" checked>
                            <label class="form-check-label" for="stockAlert">স্টক এলার্ট দেখান</label>
                        </div>
                    </div>
                    
                    <div class="col-12">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="autoSave" checked>
                            <label class="form-check-label" for="autoSave">অটো সেভ</label>
                        </div>
                    </div>
                    
                    <div class="col-12">
                        <button class="btn btn-warning w-100" onclick="exportData()"><i class="bi bi-download"></i> ডাটা এক্সপোর্ট করুন</button>
                    </div>
                    
                    <div class="col-12">
                        <button class="btn btn-danger w-100" onclick="resetData()"><i class="bi bi-arrow-clockwise"></i> সব ডাটা রিসেট করুন</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ফ্লোটিং অ্যাকশন বাটন -->
<div class="fab-container">
    <button class="btn btn-danger fab-btn" onclick="clearCart()" title="কার্ট খালি করুন">
        <i class="bi bi-trash3-fill"></i>
    </button>
    <button class="btn btn-primary fab-btn" onclick="printOrder()" title="প্রিন্ট করুন">
        <i class="bi bi-printer-fill"></i>
    </button>
    <button class="btn fab-btn" style="background:linear-gradient(90deg, #25D366, #128C7E);color:white;" 
            onclick="sendViaWhatsApp()" title="হোয়াটসঅ্যাপে পাঠান">
        <i class="bi bi-whatsapp"></i>
    </button>
    <button class="btn btn-success fab-btn" onclick="saveTemplate()" title="টেমপ্লেট সেভ করুন">
        <i class="bi bi-bookmark-plus"></i>
    </button>
</div>

<!-- বুটস্ট্রাপ JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- চার্ট JS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
// পাসওয়ার্ড চেক
function checkPass() {
    if (document.getElementById('passInput').value === '536908') {
        document.getElementById('passwordScreen').style.display = 'none';
        loadAllData();
    } else {
        alert('ভুল পাসওয়ার্ড!');
        document.getElementById('passInput').value = '';
    }
}

// Enter চাপলেও খুলবে
document.getElementById('passInput').addEventListener('keyup', function(e) {
    if (e.key === 'Enter') checkPass();
});

// প্রোডাক্ট ডাটা (JSON ফাইল থেকে লোড করার সিমুলেশন)
let products = [];
let cart = [];
let customers = [];
let orderTemplates = [];
let orderHistory = [];
let stockHistory = [];

// ডাটা লোড ফাংশন
function loadAllData() {
    // প্রোডাক্ট ডাটা লোড
    products = [
        {sl:1,name:"Mam Mam Baby Diaper - Pant",size:"S 5",price:80,stock:0},
        {sl:2,name:"Mam Mam Baby Diaper - Pant",size:"M 5",price:80,stock:0},
        {sl:3,name:"Mam Mam Baby Diaper - Pant",size:"L 5",price:80,stock:0},
        {sl:4,name:"Mam Mam Baby Diaper - Pant",size:"XL 4",price:80,stock:0},
        {sl:5,name:"Mam Mam Baby Diaper - Pant",size:"XXL 4",price:80,stock:0},
        {sl:6,name:"Mam Mam Baby Diaper - Pant",size:"S 42",price:615.33,stock:0},
        {sl:7,name:"Mam Mam Baby Diaper - Pant",size:"M 40",price:615.33,stock:0},
        {sl:8,name:"Mam Mam Baby Diaper - Pant",size:"L 40",price:673.55,stock:0},
        {sl:9,name:"Mam Mam Baby Diaper - Pant",size:"XL 30",price:528.89,stock:0},
        {sl:10,name:"Mam Mam Baby Diaper - Pant",size:"XXL 30",price:718.33,stock:0},
        {sl:11,name:"Mam Mam Baby Diaper - Velcro",size:"S 5",price:87,stock:0},
        {sl:12,name:"Mam Mam Baby Diaper - Velcro",size:"M 5",price:87,stock:0},
        {sl:13,name:"Mam Mam Baby Diaper - Velcro",size:"S 44",price:735,stock:0},
        {sl:14,name:"Mam Mam Baby Diaper - Velcro",size:"M 40",price:735,stock:0},
        {sl:15,name:"Glow Detergent Powder",size:"25g",price:3.76,stock:0},
        {sl:16,name:"Glow Detergent Powder",size:"200g",price:31.43,stock:0},
        {sl:17,name:"Glow Detergent Powder",size:"500g",price:66,stock:0},
        {sl:18,name:"Glow Detergent Powder",size:"2,000g",price:318.46,stock:0},
        {sl:19,name:"Akij Max Wash Detergent Powder",size:"200g",price:21.98,stock:0},
        {sl:20,name:"Akij Max Wash Detergent Powder",size:"500g",price:55.05,stock:0},
        {sl:21,name:"Akij Max Wash Detergent Powder",size:"1,000g",price:120,stock:0},
        {sl:22,name:"Akij Max Wash Detergent Powder",size:"2,000g",price:298.42,stock:0},
        {sl:23,name:"Akij Health+ Soap (Original)",size:"100g",price:47.14,stock:0},
        {sl:24,name:"Akij Health+ Soap (Mild)",size:"100g",price:47.14,stock:0},
        {sl:25,name:"Akij Health+ Soap (Fresh)",size:"100g",price:47.14,stock:0},
        {sl:26,name:"Akij Health+ Soap (Lemon)",size:"100g",price:47.14,stock:0},
        {sl:27,name:"Ava Beauty Soap (Jasmine)",size:"25g",price:8.25,stock:0},
        {sl:28,name:"Ava Beauty Soap (Sandalwood)",size:"25g",price:8.25,stock:0},
        {sl:29,name:"Ava Beauty Soap (Rose)",size:"25g",price:8.25,stock:0},
        {sl:30,name:"Ava Beauty Soap (Lemon)",size:"25g",price:8.25,stock:0},
        {sl:31,name:"Ava Beauty Soap (Jasmine)",size:"100g",price:42.49,stock:0},
        {sl:32,name:"Ava Beauty Soap (Sandalwood)",size:"100g",price:42.49,stock:0},
        {sl:33,name:"Ava Beauty Soap (Rose)",size:"100g",price:42.49,stock:0},
        {sl:34,name:"Ava Beauty Soap (Lemon)",size:"100g",price:42.49,stock:0},
        {sl:35,name:"Akij Soft Glycerin",size:"60ml",price:48.89,stock:0},
        {sl:36,name:"Akij Soft Glycerin",size:"120ml",price:88.89,stock:0},
        {sl:37,name:"Akij Health+ Hand Wash (Rose) Pump",size:"200ml",price:85.62,stock:0},
        {sl:38,name:"Akij Health+ Hand Wash (Rose) Refill",size:"170ml",price:58.37,stock:0},
        {sl:39,name:"Akij Health+ Hand Wash (Floral) Pump",size:"200ml",price:79.5,stock:0},
        {sl:40,name:"Akij Health+ Hand Wash (Floral) Refill",size:"170ml",price:58.37,stock:0},
        {sl:41,name:"Sakhi Sanitary Napkin - Belt",size:"8 Pcs",price:43.71,stock:0},
        {sl:42,name:"Sakhi Sanitary Napkin - Panty",size:"8 Pcs",price:53.33,stock:0},
        {sl:43,name:"Sakhi Sanitary Napkin - Belt",size:"15 Pcs",price:82.67,stock:0},
        {sl:44,name:"Sakhi Sanitary Napkin - Panty",size:"15 Pcs",price:87.11,stock:0},
        {sl:45,name:"Purple Sanitary Napkin - Regular Flow",size:"8 Pcs",price:60,stock:0},
        {sl:46,name:"Purple Sanitary Napkin - Regular Flow",size:"15 Pcs",price:88.89,stock:0},
        {sl:47,name:"Dish Master (Dishwashing Liquid)",size:"500ml",price:98.57,stock:0},
        {sl:48,name:"Dish Master (Dishwashing Liquid)",size:"250ml",price:49.29,stock:0},
        {sl:49,name:"Dish Master (Dishwashing Bar)",size:"300g",price:30,stock:0},
        {sl:50,name:"Dish Master (Dishwashing Bar)",size:"75g",price:7.71,stock:0},
        {sl:51,name:"Fantastic Air Freshener (Lemon)",size:"300ml",price:214.22,stock:0},
        {sl:52,name:"Fantastic Air Freshener (Lavender)",size:"300ml",price:214.22,stock:0},
        {sl:53,name:"Fantastic Air Freshener (Anti-Tobacco)",size:"300ml",price:214.22,stock:0},
        {sl:54,name:"Fantastic Air Freshener (Natural Orchid)",size:"300ml",price:214.22,stock:0},
        {sl:55,name:"Fantastic Air Freshener (Citrus Breeze)",size:"300ml",price:214.22,stock:0},
        {sl:56,name:"Fantastic Air Freshener (Floral Bloom)",size:"300ml",price:214.22,stock:0},
        {sl:57,name:"Fantastic Air Freshener (Aromatic Cinnamon)",size:"300ml",price:214.22,stock:0},
        {sl:58,name:"Fantastic Air Freshener (Wild Rose)",size:"300ml",price:214.22,stock:0},
        {sl:59,name:"Fantastic Air Freshener Block (Jasmine)",size:"50g",price:40,stock:0},
        {sl:60,name:"Fantastic Air Freshener Block (Rose)",size:"50g",price:40,stock:0},
        {sl:61,name:"Fantastic Air Freshener Block (Orchid)",size:"50g",price:40,stock:0},
        {sl:62,name:"Fantastic Air Freshener Block (Lavender)",size:"50g",price:40,stock:0},
        {sl:63,name:"Attack Toilet Cleaner",size:"550ml",price:96.03,stock:0},
        {sl:64,name:"Crystal Glass Cleaner",size:"350ml",price:115.67,stock:0}
    ];

    // লোকাল স্টোরেজ থেকে ডাটা লোড
    cart = JSON.parse(localStorage.getItem('akijCart') || '[]');
    customers = JSON.parse(localStorage.getItem('akijCustomers') || '[]');
    orderTemplates = JSON.parse(localStorage.getItem('akijTemplates') || '[]');
    orderHistory = JSON.parse(localStorage.getItem('akijHistory') || '[]');
    stockHistory = JSON.parse(localStorage.getItem('akijStockHistory') || '[]');
    
    // তারিখ সেট
    const today = new Date();
    const tomorrow = new Date(today); 
    tomorrow.setDate(today.getDate() + 1);
    document.getElementById('deliveryDate').min = today.toISOString().split('T')[0];
    document.getElementById('deliveryDate').value = tomorrow.toISOString().split('T')[0];
    
    // রিপোর্ট তারিখ সেট
    const weekAgo = new Date(today);
    weekAgo.setDate(today.getDate() - 7);
    document.getElementById('reportStartDate').value = weekAgo.toISOString().split('T')[0];
    document.getElementById('reportEndDate').value = today.toISOString().split('T')[0];
    
    // UI রেন্ডার
    render();
    renderCustomers();
    renderTemplates();
    renderStockManagement();
    updateCustomerDatalist();
}

// প্রোডাক্ট রেন্ডার
function render(list = products) {
    let html = '';
    const stockAlert = document.getElementById('stockAlert')?.checked ?? true;
    
    list.forEach(p => {
        const qty = cart.find(c => c.sl === p.sl)?.qty || 0;
        let stockClass = '';
        let stockText = '';
        
        if (stockAlert) {
            if (p.stock === 0) {
                stockClass = 'stock-out';
                stockText = '<small class="text-danger"><i class="bi bi-x-circle"></i> স্টক নেই</small>';
            } else if (p.stock < 5) {
                stockClass = 'stock-low';
                stockText = `<small class="text-warning"><i class="bi bi-exclamation-triangle"></i> কম স্টক (${p.stock})</small>`;
            } else {
                stockText = `<small class="text-success"><i class="bi bi-check-circle"></i> স্টক আছে</small>`;
            }
        }
        
        html += `<div class="product-card ${stockClass}">
            <div class="d-flex justify-content-between align-items-start">
                <div class="flex-grow-1 me-2">
                    <h6 class="mb-1 fw-bold">${p.name}</h6>
                    <small class="opacity-80">${p.size}</small>
                    <div class="mt-1 text-warning fw-bold">৳${p.price.toFixed(2)}</div>
                    ${stockText}
                </div>
                <input type="number" min="0" max="999" value="${qty}" class="form-control text-center" style="width:90px;" onchange="safeUpdateQty(${p.sl}, this.value)">
            </div>
        </div>`;
    });
    
    document.getElementById('productList').innerHTML = html || '<p class="text-center py-5 opacity-70 fw-bold">কোনো প্রোডাক্ট পাওয়া যায়নি</p>';
    calcTotal();
}

// নিরাপদভাবে কোয়ান্টিটি আপডেট
function safeUpdateQty(sl, val) {
    try {
        val = Math.max(0, parseInt(val) || 0);
        if(val > 999) {
            alert('একবারে ৯৯৯টির বেশি অর্ডার করা যাবে না');
            return;
        }
        updateQty(sl, val);
    } catch(error) {
        console.error('Error updating quantity:', error);
        alert('সিস্টেমে সমস্যা হয়েছে। আবার চেষ্টা করুন।');
    }
}

// কোয়ান্টিটি আপডেট
function updateQty(sl, val) {
    val = parseInt(val) || 0;
    cart = cart.filter(c => c.sl !== sl);
    if (val > 0) cart.push({sl, qty: val});
    localStorage.setItem('akijCart', JSON.stringify(cart));
    render();
    
    // অটো সেভ চেক
    if (document.getElementById('autoSave')?.checked) {
        const shopName = document.getElementById('shopName').value;
        if (shopName) {
            saveOrderHistory();
        }
    }
}

// টোটাল ক্যালকুলেশন
function calcTotal() {
    let total = 0, items = 0;
    cart.forEach(c => {
        const p = products.find(x => x.sl === c.sl);
        if (p) { total += p.price * c.qty; items += c.qty; }
    });
    document.getElementById('totalAmount').textContent = total.toFixed(2);
    document.getElementById('cartCount').textContent = items;
}

// সার্চ ফাংশন (ডিবাউন্স সহ)
let searchTimeout;
document.getElementById('search').addEventListener('input', e => {
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => {
        const term = e.target.value.toLowerCase();
        const filtered = products.filter(p => 
            p.name.toLowerCase().includes(term) || 
            p.size.toLowerCase().includes(term)
        );
        render(filtered);
    }, 300);
});

// কার্ট ক্লিয়ার
function clearCart() {
    if (confirm('পুরো কার্ট খালি করবেন?')) {
        cart = []; 
        localStorage.removeItem('akijCart'); 
        render();
    }
}

// প্রিন্ট অর্ডার
function printOrder() {
    if (cart.length === 0) return alert('কার্ট খালি আছে!');
    const shop = document.getElementById('shopName').value.trim() || 'দোকানের নাম নেই';
    const address = document.getElementById('shopAddress').value.trim() || 'ঠিকানা নেই';
    const mobile = document.getElementById('mobile').value.trim() || '';
    const delivery = document.getElementById('deliveryDate').value ? 
        new Date(document.getElementById('deliveryDate').value).toLocaleDateString('bn-BD') : 'নির্দিষ্ট নয়';

    let rows = '', sl = 1, total = 0;
    cart.forEach(c => {
        const p = products.find(x => x.sl === c.sl);
        if (!p) return;
        const line = p.price * c.qty; 
        total += line;
        rows += `<tr><td style="padding:10px;text-align:center;border:1px solid #333">${sl++}</td>
                 <td style="padding:10px;border:1px solid #333">${p.name}</td>
                 <td style="padding:10px;border:1px solid #333;text-align:center">${p.size}</td>
                 <td style="padding:10px;border:1px solid #333;text-align:center;font-weight:bold">${c.qty}</td>
                 <td style="padding:10px;border:1px solid #333;text-align:right">৳${p.price.toFixed(2)}</td>
                 <td style="padding:10px;border:1px solid #333;text-align:right;font-weight:bold">৳${line.toFixed(2)}</td></tr>`;
    });

    const win = window.open('', '', 'width=900,height=1000');
    win.document.write(`<!DOCTYPE html>
<html><head><meta charset="utf-8"><title>আকিজ অর্ডার - ${shop}</title>
<link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&display=swap" rel="stylesheet">
<style>
    body{font-family:'Hind Siliguri',sans-serif;margin:25px;font-size:16px;line-height:1.8;background:white;color:black;}
    h2,h3{text-align:center;color:#0d6efd;margin:15px 0;}
    .info{background:#f0f8ff;padding:20px;border-radius:12px;margin:20px 0;border:2px solid #0d6efd;font-size:16px;}
    table{width:100%;border-collapse:collapse;margin:30px 0;}
    th{background:#0d6efd;color:white;padding:12px;font-weight:700;}
    td{border:1px solid #333;padding:10px;}
    .total{font-size:22px;font-weight:bold;text-align:right;padding:15px;background:#ecfdf5;border:2px solid #10b981;border-radius:12px;margin:25px 0;}
    @page {size: A4; margin:8mm;}
</style>
</head><body>
<h2>আকিজ হেলথকেয়ার এন্ড হাইজিন লিমিটেড</h2>
<h3>অর্ডার ফর্ম</h3>
<div class="info">
    <strong>এসআর:</strong> অসীম কর্মকার • ডুমুরিয়া • ${new Date().toLocaleString('bn-BD')}<br>
    <strong>দোকান:</strong> ${shop}<br>
    <strong>ঠিকানা:</strong> ${address}<br>
    <strong>মোবাইল:</strong> ${mobile} | <strong>ডেলিভারি তারিখ:</strong> ${delivery}
</div>
<table><thead><tr><th>ক্রম</th><th>প্রোডাক্ট নাম</th><th>সাইজ</th><th>পরিমাণ</th><th>দর</th><th>মোট টাকা</th></tr></thead><tbody>${rows}</tbody></table>
<div class="total">সর্বমোট: ৳${total.toFixed(2)}</div>
<div style="text-align:center;margin-top:70px;font-size:18px;font-weight:bold;color:#0d6efd;">
    ধন্যবাদ! আকিজের সাথে থাকুন।
</div>
</body></html>`);
    win.document.close();
    setTimeout(() => { win.focus(); win.print(); }, 800);
    
    // অর্ডার হিস্ট্রি সেভ
    saveOrderHistory();
    
    // স্টক আপডেট
    updateStockOnOrder();
}

// হোয়াটসঅ্যাপে পাঠান
function sendViaWhatsApp() {
    if (cart.length === 0) return alert('কার্ট খালি!');
    let msg = `*আকিজ হেলথকেয়ার অর্ডার*%0A*অসীম কর্মকার • ডুমুরিয়া*%0A%0A`;
    const shop = document.getElementById('shopName').value || 'দোকানের নাম নেই';
    const address = document.getElementById('shopAddress').value || 'ঠিকানা নেই';
    const mobile = document.getElementById('mobile').value || '';
    const delivery = document.getElementById('deliveryDate').value ? 
        new Date(document.getElementById('deliveryDate').value).toLocaleDateString('bn-BD') : 'নির্দিষ্ট নয়';
    
    msg += `দোকান: ${shop}%0Aঠিকানা: ${address}%0Aমোবাইল: ${mobile}%0Aডেলিভারি: ${delivery}%0A%0A`;
    cart.forEach(c => {
        const p = products.find(x => x.sl === c.sl);
        if (p) msg += `• ${p.name} (${p.size}) × ${c.qty} = ৳${(p.price * c.qty).toFixed(2)}%0A`;
    });
    msg += `%0A*মোট অর্ডার: ৳${document.getElementById('totalAmount').textContent}*`;
    window.open('https://wa.me/?text=' + msg, '_blank');
    
    // অর্ডার হিস্ট্রি সেভ
    saveOrderHistory();
    
    // স্টক আপডেট
    updateStockOnOrder();
}

// অর্ডার হিস্ট্রি সেভ
function saveOrderHistory() {
    const shop = document.getElementById('shopName').value.trim();
    if (!shop) return;
    
    const order = {
        id: Date.now(),
        date: new Date().toISOString(),
        shop: shop,
        address: document.getElementById('shopAddress').value.trim(),
        mobile: document.getElementById('mobile').value.trim(),
        delivery: document.getElementById('deliveryDate').value,
        items: cart.length,
        total: parseFloat(document.getElementById('totalAmount').textContent),
        products: [...cart]
    };
    
    orderHistory.unshift(order);
    // সর্বোচ্চ 100টি অর্ডার রাখা হবে
    if (orderHistory.length > 100) orderHistory.pop();
    
    localStorage.setItem('akijHistory', JSON.stringify(orderHistory));
}

// কাস্টমার ম্যানেজমেন্ট
function addCustomer() {
    const name = document.getElementById('customerName').value.trim();
    const mobile = document.getElementById('customerMobile').value.trim();
    const area = document.getElementById('customerArea').value.trim();
    const address = document.getElementById('customerAddress').value.trim();
    
    if (!name || !mobile) {
        alert('কাস্টমারের নাম এবং মোবাইল নম্বর অবশ্যই দিতে হবে');
        return;
    }
    
    const customer = {
        id: Date.now(),
        name: name,
        mobile: mobile,
        area: area,
        address: address,
        createdAt: new Date().toISOString()
    };
    
    customers.push(customer);
    localStorage.setItem('akijCustomers', JSON.stringify(customers));
    
    // ফর্ম ক্লিয়ার
    document.getElementById('customerName').value = '';
    document.getElementById('customerMobile').value = '';
    document.getElementById('customerArea').value = '';
    document.getElementById('customerAddress').value = '';
    
    renderCustomers();
    updateCustomerDatalist();
    alert('কাস্টমার সফলভাবে যোগ করা হয়েছে!');
}

function renderCustomers() {
    const tbody = document.getElementById('customerTable');
    let html = '';
    
    customers.forEach(c => {
        html += `<tr>
            <td>${c.name}</td>
            <td>${c.mobile}</td>
            <td>${c.area}</td>
            <td>
                <button class="btn btn-sm btn-primary me-1" onclick="loadCustomerToOrder('${c.name}', '${c.address}', '${c.mobile}')">
                    <i class="bi bi-cart-plus"></i>
                </button>
                <button class="btn btn-sm btn-danger" onclick="deleteCustomer(${c.id})">
                    <i class="bi bi-trash"></i>
                </button>
            </td>
        </tr>`;
    });
    
    tbody.innerHTML = html || '<tr><td colspan="4" class="text-center">কোনো কাস্টমার নেই</td></tr>';
}

function deleteCustomer(id) {
    if (confirm('এই কাস্টমার ডিলিট করবেন?')) {
        customers = customers.filter(c => c.id !== id);
        localStorage.setItem('akijCustomers', JSON.stringify(customers));
        renderCustomers();
        updateCustomerDatalist();
    }
}

function loadCustomerToOrder(name, address, mobile) {
    document.getElementById('shopName').value = name;
    document.getElementById('shopAddress').value = address;
    document.getElementById('mobile').value = mobile;
    
    // অর্ডার ট্যাবে ফিরে যান
    document.getElementById('home-tab').click();
}

function updateCustomerDatalist() {
    const datalist = document.getElementById('customerList');
    let html = '';
    
    customers.forEach(c => {
        html += `<option value="${c.name}">${c.mobile} - ${c.area}</option>`;
    });
    
    datalist.innerHTML = html;
}

// টেমপ্লেট ম্যানেজমেন্ট
function saveTemplate() {
    if (cart.length === 0) return alert('কার্ট খালি! টেমপ্লেট সেভ করতে আইটেম যোগ করুন।');
    
    const name = prompt('টেমপ্লেটের নাম দিন:', `টেমপ্লেট-${orderTemplates.length + 1}`);
    if (!name) return;
    
    const template = {
        id: Date.now(),
        name: name,
        products: [...cart],
        createdAt: new Date().toISOString()
    };
    
    orderTemplates.push(template);
    localStorage.setItem('akijTemplates', JSON.stringify(orderTemplates));
    renderTemplates();
    alert('টেমপ্লেট সফলভাবে সেভ করা হয়েছে!');
}

function renderTemplates() {
    const container = document.getElementById('templateList');
    let html = '';
    
    orderTemplates.forEach(t => {
        let total = 0;
        t.products.forEach(p => {
            const product = products.find(prod => prod.sl === p.sl);
            if (product) total += product.price * p.qty;
        });
        
        html += `<div class="col-md-6 col-lg-4 mb-3">
            <div class="card template-card bg-dark bg-opacity-25 text-white p-3" onclick="loadTemplate(${t.id})">
                <h6 class="card-title">${t.name}</h6>
                <small>${t.products.length} আইটেম</small>
                <div class="mt-2 text-warning fw-bold">৳${total.toFixed(2)}</div>
                <small class="text-muted">${new Date(t.createdAt).toLocaleDateString('bn-BD')}</small>
                <button class="btn btn-sm btn-danger mt-2" onclick="event.stopPropagation(); deleteTemplate(${t.id})">
                    <i class="bi bi-trash"></i> ডিলিট
                </button>
            </div>
        </div>`;
    });
    
    container.innerHTML = html || '<div class="col-12 text-center py-5"><p>কোনো টেমপ্লেট নেই</p></div>';
}

function loadTemplate(id) {
    const template = orderTemplates.find(t => t.id === id);
    if (!template) return;
    
    cart = [...template.products];
    localStorage.setItem('akijCart', JSON.stringify(cart));
    render();
    
    // অর্ডার ট্যাবে ফিরে যান
    document.getElementById('home-tab').click();
    alert(`"${template.name}" টেমপ্লেট লোড করা হয়েছে!`);
}

function deleteTemplate(id) {
    if (confirm('এই টেমপ্লেট ডিলিট করবেন?')) {
        orderTemplates = orderTemplates.filter(t => t.id !== id);
        localStorage.setItem('akijTemplates', JSON.stringify(orderTemplates));
        renderTemplates();
    }
}

// স্টক ম্যানেজমেন্ট ফাংশন
function updateStock() {
    const productSelect = document.getElementById('stockProduct');
    const productId = parseInt(productSelect.value);
    const action = document.getElementById('stockAction').value;
    const quantity = parseInt(document.getElementById('stockQty').value);
    const note = document.getElementById('stockNote').value.trim();
    
    if (!productId || !quantity || quantity <= 0) {
        alert('সব তথ্য সঠিকভাবে পূরণ করুন');
        return;
    }
    
    const product = products.find(p => p.sl === productId);
    if (!product) {
        alert('প্রোডাক্ট পাওয়া যায়নি');
        return;
    }
    
    let newStock = product.stock;
    let changeType = '';
    
    switch(action) {
        case 'add':
            newStock += quantity;
            changeType = 'যোগ';
            break;
        case 'subtract':
            if (quantity > product.stock) {
                alert('স্টক পর্যাপ্ত নেই! বর্তমান স্টক: ' + product.stock);
                return;
            }
            newStock -= quantity;
            changeType = 'বিয়োগ';
            break;
        case 'set':
            newStock = quantity;
            changeType = 'সেট';
            break;
    }
    
    // প্রোডাক্ট স্টক আপডেট
    product.stock = newStock;
    
    // স্টক হিস্ট্রিতে যোগ
    const historyEntry = {
        id: Date.now(),
        date: new Date().toISOString(),
        productId: productId,
        productName: product.name,
        productSize: product.size,
        action: action,
        changeType: changeType,
        quantity: quantity,
        previousStock: product.stock - (action === 'add' ? -quantity : action === 'subtract' ? quantity : 0),
        newStock: newStock,
        note: note
    };
    
    stockHistory.unshift(historyEntry);
    localStorage.setItem('akijStockHistory', JSON.stringify(stockHistory));
    
    // UI আপডেট
    renderStockManagement();
    render(); // প্রোডাক্ট লিস্ট আপডেট
    
    // ফর্ম রিসেট
    document.getElementById('stockQty').value = '';
    document.getElementById('stockNote').value = '';
    
    alert('স্টক সফলভাবে আপডেট করা হয়েছে!');
}

// স্টক ম্যানেজমেন্ট UI রেন্ডার
function renderStockManagement() {
    // প্রোডাক্ট সিলেক্ট অপশন আপডেট
    const productSelect = document.getElementById('stockProduct');
    let options = '<option value="">প্রোডাক্ট নির্বাচন করুন</option>';
    
    products.forEach(p => {
        options += `<option value="${p.sl}">${p.name} (${p.size}) - স্টক: ${p.stock}</option>`;
    });
    
    productSelect.innerHTML = options;
    
    // স্টক হিস্ট্রি টেবিল আপডেট
    const historyTable = document.getElementById('stockHistoryTable');
    let historyHtml = '';
    
    stockHistory.slice(0, 50).forEach(entry => {
        historyHtml += `<tr>
            <td>${new Date(entry.date).toLocaleDateString('bn-BD')}</td>
            <td>${entry.productName}<br><small>${entry.productSize}</small></td>
            <td>${entry.changeType}</td>
            <td>${entry.quantity}</td>
            <td>${entry.note || '-'}</td>
        </tr>`;
    });
    
    historyTable.innerHTML = historyHtml || '<tr><td colspan="5" class="text-center">কোনো স্টক হিস্ট্রি নেই</td></tr>';
    
    // কম স্টক এবং স্টক ফুরানো লিস্ট আপডেট
    const lowStockList = document.getElementById('lowStockList');
    const outOfStockList = document.getElementById('outOfStockList');
    
    let lowStockHtml = '';
    let outOfStockHtml = '';
    
    products.forEach(p => {
        if (p.stock === 0) {
            outOfStockHtml += `<div class="product-card stock-out mb-2">
                <h6 class="mb-1">${p.name}</h6>
                <small>${p.size}</small>
                <div class="text-danger fw-bold mt-1">স্টক নেই</div>
            </div>`;
        } else if (p.stock < 5) {
            lowStockHtml += `<div class="product-card stock-low mb-2">
                <h6 class="mb-1">${p.name}</h6>
                <small>${p.size}</small>
                <div class="text-warning fw-bold mt-1">স্টক: ${p.stock}</div>
            </div>`;
        }
    });
    
    lowStockList.innerHTML = lowStockHtml || '<p class="text-center py-3">কোনো কম স্টক প্রোডাক্ট নেই</p>';
    outOfStockList.innerHTML = outOfStockHtml || '<p class="text-center py-3">সব প্রোডাক্টের স্টক আছে</p>';
}

// অর্ডার দেওয়ার সময় স্টক আপডেট
function updateStockOnOrder() {
    cart.forEach(item => {
        const product = products.find(p => p.sl === item.sl);
        if (product && product.stock >= item.qty) {
            product.stock -= item.qty;
            
            // স্টক হিস্ট্রিতে যোগ
            const historyEntry = {
                id: Date.now(),
                date: new Date().toISOString(),
                productId: product.sl,
                productName: product.name,
                productSize: product.size,
                action: 'subtract',
                changeType: 'বিয়োগ',
                quantity: item.qty,
                previousStock: product.stock + item.qty,
                newStock: product.stock,
                note: 'অর্ডার থেকে স্বয়ংক্রিয় কাটা'
            };
            
            stockHistory.unshift(historyEntry);
        }
    });
    
    localStorage.setItem('akijStockHistory', JSON.stringify(stockHistory));
}

// রিপোর্ট জেনারেশন
function generateReport() {
    const startDate = document.getElementById('reportStartDate').value;
    const endDate = document.getElementById('reportEndDate').value;
    
    if (!startDate || !endDate) {
        alert('শুরু এবং শেষ তারিখ নির্বাচন করুন');
        return;
    }
    
    const filteredOrders = orderHistory.filter(order => {
        const orderDate = order.date.split('T')[0];
        return orderDate >= startDate && orderDate <= endDate;
    });
    
    // টেবিল আপডেট
    const tbody = document.getElementById('reportTable');
    let html = '';
    let totalSales = 0;
    
    filteredOrders.forEach(order => {
        totalSales += order.total;
        html += `<tr>
            <td>${new Date(order.date).toLocaleDateString('bn-BD')}</td>
            <td>${order.shop}</td>
            <td>${order.items}</td>
            <td>৳${order.total.toFixed(2)}</td>
        </tr>`;
    });
    
    tbody.innerHTML = html || '<tr><td colspan="4" class="text-center">এই সময়ে কোনো অর্ডার নেই</td></tr>';
    
    // চার্ট আপডেট
    updateSalesChart(filteredOrders, totalSales);
}

function updateSalesChart(orders, totalSales) {
    const ctx = document.getElementById('salesChart').getContext('2d');
    
    // তারিখ অনুযায়ী গ্রুপ করা
    const salesByDate = {};
    orders.forEach(order => {
        const date = order.date.split('T')[0];
        if (!salesByDate[date]) {
            salesByDate[date] = 0;
        }
        salesByDate[date] += order.total;
    });
    
    const dates = Object.keys(salesByDate).sort();
    const amounts = dates.map(date => salesByDate[date]);
    
    // বিদ্যমান চার্ট ডেস্ট্রয় করুন
    if (window.salesChartInstance) {
        window.salesChartInstance.destroy();
    }
    
    // নতুন চার্ট তৈরি করুন
    window.salesChartInstance = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: dates.map(date => new Date(date).toLocaleDateString('bn-BD')),
            datasets: [{
                label: 'বিক্রয় (৳)',
                data: amounts,
                backgroundColor: 'rgba(54, 162, 235, 0.5)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: `মোট বিক্রয়: ৳${totalSales.toFixed(2)}`
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
}

// ডাটা এক্সপোর্ট
function exportData() {
    const data = {
        products: products,
        customers: customers,
        templates: orderTemplates,
        history: orderHistory,
        stockHistory: stockHistory,
        exportDate: new Date().toISOString()
    };
    
    const dataStr = JSON.stringify(data, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});
    
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `akij_data_${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    alert('ডাটা সফলভাবে এক্সপোর্ট করা হয়েছে!');
}

// ডাটা রিসেট
function resetData() {
    if (confirm('সব ডাটা রিসেট করবেন? এটি পূর্বের সব তথ্য মুছে ফেলবে!')) {
        localStorage.removeItem('akijCart');
        localStorage.removeItem('akijCustomers');
        localStorage.removeItem('akijTemplates');
        localStorage.removeItem('akijHistory');
        localStorage.removeItem('akijStockHistory');
        
        cart = [];
        customers = [];
        orderTemplates = [];
        orderHistory = [];
        stockHistory = [];
        
        render();
        renderCustomers();
        renderTemplates();
        renderStockManagement();
        
        alert('সব ডাটা রিসেট করা হয়েছে!');
    }
}

// Service Worker রেজিস্ট্রেশন (অফলাইন সাপোর্ট)
if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
        navigator.serviceWorker.register('/sw.js')
        .then(function(registration) {
            console.log('ServiceWorker registration successful');
        })
        .catch(function(err) {
            console.log('ServiceWorker registration failed: ', err);
        });
    });
}

// প্রথম লোডে সব ডাটা লোড
window.addEventListener('DOMContentLoaded', function() {
    // পাসওয়ার্ড স্ক্রিন দেখানো হবে
});
</script>
</body>
</html>